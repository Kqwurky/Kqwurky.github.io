<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Cape Uploader</title>
</head>
<body>
    <h1>Custom Cape Uploader</h1>
    <p>Upload eine Datei (32x64 PNG) und erhalte ein Minecraft MCPACK:</p>
    <input type="file" id="fileInput" accept=".png" required>
    <button id="generateButton">Generate MCPACK</button>
    <p id="status"></p>
    <a id="downloadLink" style="display:none;">Download MCPACK</a>

    <script>
        document.getElementById('generateButton').addEventListener('click', async () => {
            const fileInput = document.getElementById('fileInput');
            const status = document.getElementById('status');
            const downloadLink = document.getElementById('downloadLink');

            // Prüfen, ob eine Datei ausgewählt wurde
            if (!fileInput.files.length) {
                status.textContent = "Bitte wähle eine Datei aus.";
                return;
            }

            const file = fileInput.files[0];

            // Erstellen der Ordnerstruktur
            const folderStructure = {
                "Custom_Capes/": {},
                "Custom_Capes/textures/": {},
                "Custom_Capes/textures/entity/": {
                    "custom.png": new Blob([await file.arrayBuffer()], { type: file.type })
                }
            };

            // Erstellen der ZIP-Datei
            const zipBlob = await createZip(folderStructure);

            // Erstellen des .mcpack
            const mcpackBlob = new Blob([zipBlob], { type: 'application/zip' });
            const mcpackFileName = "Custom_Capes.mcpack";

            // Download-Link generieren
            const mcpackUrl = URL.createObjectURL(mcpackBlob);
            downloadLink.href = mcpackUrl;
            downloadLink.download = mcpackFileName;
            downloadLink.textContent = "Download MCPACK";
            downloadLink.style.display = "inline-block";

            status.textContent = "MCPACK generiert!";
        });

        // Hilfsfunktion: ZIP-Datei erstellen
        async function createZip(structure, root = '') {
            const JSZip = await import('https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js');
            const zip = new JSZip();

            function addFolderOrFile(folder, path) {
                for (const [name, content] of Object.entries(folder)) {
                    if (typeof content === 'object' && !(content instanceof Blob)) {
                        const subFolder = zip.folder(path + name);
                        addFolderOrFile(content, path + name + '/');
                    } else {
                        zip.file(path + name, content);
                    }
                }
            }

            addFolderOrFile(structure, root);
            return zip.generateAsync({ type: 'blob' });
        }
    </script>
</body>
</html>